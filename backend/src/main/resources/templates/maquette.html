<!--
  IMPORTANT: Ce fragment contient des caractÃ¨res accentuÃ©s.
  1) Si ce fichier est inclus dans une page complÃ¨te (Angular index.html), assurez-vous que index.html contient dans <head> :
     <meta charset="UTF-8">
  2) Sauvegardez ce fichier en UTF-8 (UTFâ€‘8 sans BOM) dans votre Ã©diteur/IDE.
  3) Le backend doit Ã©galement envoyer l'en-tÃªte HTTP Content-Type avec "charset=UTF-8" (voir application.properties ciâ€‘dessous).
-->
<meta charset="UTF-8">

<!--
  Angular-oriented static mockup (component template) for the Wakfu Damage & Combo Simulator UI.
  Tech: Angular (front), Java backend. v2 â€“ integrates: multi-enemy, map drag&drop placement, timeline emphasis,
  12-spell bar, 6 passives (level-locked), 10 sublis, mechanisms placed ONLY by spells, dial hour fixed to 12 at placement.
-->
<style>
    :root{ --bg:#0f1115;--panel:#181b22;--panel-2:#1d2230;--muted:#8c9bb3;--accent:#4cc9f0;--good:#7bd88f;--warn:#ffd166;--bad:#ef476f;--stroke:#2a2f3a; }
    *{box-sizing:border-box}
    body,html{margin:0;padding:0;background:var(--bg);color:#e8ecf3;font-family:Inter,Segoe UI,system-ui,-apple-system,Arial}
    .app{
        display: grid;
        grid-template-columns: 420px 1fr 440px; /* <â€” 340 â†’ 420 */
        grid-template-rows: 72px 1fr 340px;
        grid-template-areas:
            "header header header"
            "sidebar-left main sidebar-right"
            "report report report";
        min-height: 100vh;
        gap: 12px;
        padding: 12px;
    }
    .header{grid-area:header;background:var(--panel);border:1px solid var(--stroke);border-radius:16px;display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#9c6ef3)}
    .brand h1{font-size:18px;margin:0}
    .actions{display:flex;gap:8px}
    button{background:#253044;border:1px solid var(--stroke);color:#e8ecf3;border-radius:10px;padding:8px 12px;cursor:pointer}
    button.primary{background:linear-gradient(135deg,#7aa2f7,#5ad7f0);color:#0b1220;border:none}
    button.ghost{background:transparent;border-color:var(--stroke);}
    .hint{font-size:12px;color:var(--muted)}

    .panel{background:var(--panel);border:1px solid var(--stroke);border-radius:16px;padding:12px}
    .panel.tight {
        width: fit-content;    /* au lieu de max-content pour Ã©viter un surplus */
        margin-inline: auto;
    }
    .panel.board-panel {
        padding: 0;            /* enlÃ¨ve l'espace autour */
        border: none;          /* on laisse la bordure Ã  .board */
    }
    .panel h2{font-size:14px;margin:0 0 10px 0;color:#cfe3ff;letter-spacing:.2px}
    .section{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}
    .row{display:flex;gap:8px;align-items:center}
    .grid{display:grid;gap:8px}
    input,select,textarea{background:var(--panel-2);border:1px solid var(--stroke);color:#e8ecf3;border-radius:10px;padding:8px}
    input[type="number"]{width:96px}
    .pill{border:1px dashed var(--stroke);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}

    /* Sidebar left */
    .sidebar-left{grid-area:sidebar-left;display:flex;flex-direction:column;gap:12px}
    .card{background:var(--panel-2);border:1px solid var(--stroke);border-radius:14px;padding:10px}
    .list{display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto}
    .list-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border:1px solid var(--stroke);border-radius:10px;background:#1b2130}
    .list-item .meta{display:flex;flex-direction:column;font-size:12px;color:#c8d0e0}
    .tag{font-size:11px;color:#9fb3d9}

    /* Main center: board + position controls */
    .main {
        grid-template-rows: auto 1fr;
        min-height: 0;
    }
    .pos-controls{display:flex;gap:12px}
    .pos-controls .card{flex:1}

    /* --- DAMIER INTÃ‰GRAL SANS CELLS --- */
    .board{
        --cols: 13;               /* nb de cases par cÃ´tÃ© */
        --pad: 20px;              /* marge interne jouable */
        --cellA: #141a24;         /* gris A */
        --cellB: #0f151f;         /* gris B */

        position: relative;
        width: clamp(520px, 90%, 820px);
        aspect-ratio: 1 / 1;
        margin: 0 auto;
        border: 1px solid var(--stroke);
        border-radius: 12px;
        overflow: hidden;
        background: #0f141d;
    }

    /* Peint le damier sur toute la zone jouable */
    .board::before{
        content: "";
        position: absolute;
        left: var(--pad);
        top: var(--pad);
        right: var(--pad);
        bottom: var(--pad);

        /* taille d'une case (sans Â« gap Â» pour la maquette) */
        --s: calc((100% - 0px) / var(--cols) * 2);  /* 1.2 = 20 % plus large */
        background:
                conic-gradient(var(--cellA) 25%, var(--cellB) 0 50%, var(--cellA) 0 75%, var(--cellB) 0) 0 0 / var(--s) var(--s),
                conic-gradient(var(--cellB) 25%, var(--cellA) 0 50%, var(--cellB) 0 75%, var(--cellA) 0) calc(var(--s)/2) calc(var(--s)/2) / var(--s) var(--s);
        border-radius: 8px;
    }

    /* Grille logique pour aligner les entitÃ©s (aucun cell nÃ©cessaire) */
    .board-grid{
        position:absolute;
        inset: var(--pad);
        display:grid;
        grid-template-columns: repeat(var(--cols), 1fr);
        grid-template-rows: repeat(var(--cols), 1fr);
        /* pas de gap pour coller au damier peint */
    }

    /* (facultatif) si tu gardes quelques .cell pour debug, rends-les invisibles */
    .cell{ background: transparent; border: none; }

    /* EntitÃ©s alignÃ©es au centre des cases par grid-row/column */
    .entity{
        width:32px;height:32px;border-radius:6px;border:2px solid #0b1220;
        display:flex;align-items:center;justify-content:center;font-size:12px;
        user-select:none;justify-self:center;align-self:center;
    }
    .entity.fighter{ background: var(--good); }
    .entity.enemy{   background: var(--bad);  }
    .orientation{position:absolute;top:8px;left:8px;display:flex;gap:6px}
    .arrow{width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-bottom:16px solid #cde7ff;opacity:.7;transform-origin:center}
    .drop-hint{position:absolute;bottom:10px;left:10px;font-size:11px;color:#b6c7ea;background:#10152199;padding:6px 8px;border:1px solid #2a3346;border-radius:8px}

    /* Sidebar right: timeline editor (emphasis) */
    .sidebar-right{grid-area:sidebar-right;display:flex;flex-direction:column;gap:12px}
    .timeline-panel{box-shadow:0 0 0 2px #2c3a5a inset}
    .timeline-toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:6px}
    .timeline{display:flex;flex-direction:column;gap:8px;max-height:calc(100vh - 72px - 340px - 64px);overflow:auto}
    .step{display:grid;grid-template-columns:28px 1fr auto;gap:8px;align-items:center;padding:8px;border:1px solid var(--stroke);border-radius:12px;background:#1b2130}
    .handle{width:24px;height:24px;border-radius:8px;background:#2b3345;display:flex;align-items:center;justify-content:center;cursor:grab}
    .step form{display:grid;grid-template-columns:140px 1fr;gap:6px;align-items:center}
    .step .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{background:#2b344a;border:1px solid var(--stroke);padding:4px 8px;border-radius:999px;font-size:11px;color:#cfe3ff}

    /* Bars for spells / passives / sublis */
    .bar{display:grid;gap:6px}
    .bar.spells{grid-template-columns:repeat(12,1fr)}
    .bar.passives{grid-template-columns:repeat(6,1fr)}
    .bar.sublis{grid-template-columns:repeat(10,1fr)}
    .slot{aspect-ratio:1/1;border:1px dashed #33405a;border-radius:10px;background:#172033;display:flex;align-items:center;justify-content:center;font-size:11px;color:#9fb3d9;position:relative}
    .slot.lock::after{content:"ðŸ”’";position:absolute;top:4px;right:6px;font-size:12px;opacity:.8}

    /* Report area */
    .report{grid-area:report;display:grid;grid-template-rows:46px 1fr;gap:12px}
    .tabs{display:flex;gap:6px}
    .tab{padding:10px 12px;border-radius:10px;border:1px solid var(--stroke);background:#1a2030;cursor:pointer;font-size:13px}
    .tab.active{background:linear-gradient(135deg,#27314a,#1f2c44)}
    .report-content{display:grid;grid-template-columns:1.4fr 1fr;gap:12px;min-height:0}
    .chart{height:280px;background:#161b27;border:1px solid var(--stroke);border-radius:12px}
    .block{background:var(--panel);border:1px solid var(--stroke);border-radius:12px;padding:12px;overflow:auto}
    pre{white-space:pre-wrap;word-wrap:break-word;color:#d0defa}
</style>

<div class="app">
    <!-- Header -->
    <header class="header">
        <!-- Tip: In Angular index.html, add: <meta charset='UTF-8'> to avoid special character issues -->
        <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
                <h1>Wakfu â€“ Damage & Combo Simulator</h1>
                <div class="hint">Angular Front â€¢ Java Backend â€¢ Placement par carte â€¢ Timeline avancÃ©e</div>
            </div>
        </div>
        <div class="actions">
            <button class="ghost">Importer JSON Build</button>
            <button class="ghost">Exporter Projet</button>
            <button>Enregistrer maquette</button>
            <button class="primary">Lancer Simulation â–¶</button>
        </div>
    </header>

    <!-- Sidebar Left: Builds & Presets -->
    <aside class="sidebar-left">
        <div class="panel">
            <h2>Builds Ã  comparer</h2>
            <div class="row">
                <select>
                    <option>â€” Build A â€”</option>
                    <option>[XÃ©lor R185 â€“ Rouage/Distorsion]</option>
                </select>
                <select>
                    <option>â€” Build B â€”</option>
                    <option>[XÃ©lor R185 â€“ Variante burst]</option>
                </select>
            </div>
            <div class="row">
                <button>Charger</button>
                <button>Inverser</button>
                <button class="ghost">Nouveau</button>
            </div>
        </div>

        <!-- Bars (drag from modal lists) -->
        <div class="card">
            <h2>Barre de sorts (12)</h2>
            <div class="bar spells">
                <!-- 12 slots -->
                <div class="slot">1</div><div class="slot">2</div><div class="slot">3</div><div class="slot">4</div><div class="slot">5</div><div class="slot">6</div><div class="slot">7</div><div class="slot">8</div><div class="slot">9</div><div class="slot">10</div><div class="slot">11</div><div class="slot">12</div>
            </div>
            <div class="row" style="margin-top:8px">
                <button class="ghost">Sorts</button>
                <span class="hint">Cliquer Â« Sorts Â» â†’ ouvre la liste de la classe â†’ glisser un sort dans une case.</span>
            </div>
        </div>

        <div class="card">
            <h2>Passifs (6 max, niveau-gated)</h2>
            <div class="bar passives">
                <div class="slot">P1</div>
                <div class="slot">P2</div>
                <div class="slot lock" title="DÃ©bloquÃ© niv.25"></div>
                <div class="slot lock" title="DÃ©bloquÃ© niv.50"></div>
                <div class="slot lock" title="DÃ©bloquÃ© niv.100"></div>
                <div class="slot lock" title="DÃ©bloquÃ© niv.150"></div>
            </div>
            <div class="row" style="margin-top:8px">
                <button class="ghost">Passifs</button>
                <span class="hint">Glisser depuis la liste des passifs de classe. Verrou selon niveau (1/25/50/100/150/200).</span>
            </div>
        </div>

        <div class="card">
            <h2>Sublimations (12)</h2>
            <div class="bar sublis">
                <div class="slot">S1</div><div class="slot">S2</div><div class="slot">S3</div><div class="slot">S4</div><div class="slot">S5</div><div class="slot">S6</div><div class="slot">S7</div><div class="slot">S8</div><div class="slot">S9</div><div class="slot">S10</div>
                <div class="slot">Ã‰</div><div class="slot">R</div>
            </div>
            <div class="row" style="margin-top:8px">
                <button class="ghost">Sublimations</button>
                <span class="hint">Ouvre la liste (Classique/Ã‰pique/Relique). Drag & drop vers la barre.</span>
            </div>
        </div>

        <div class="card">
            <h2>Adversaires</h2>
            <div class="row">
                <label class="pill">Nombre</label>
                <select>
                    <option>1</option><option selected>2</option><option>3</option><option>4</option>
                </select>
                <button class="ghost">Distribuer sur la carte</button>
            </div>
            <div class="list">
                <div class="list-item">
                    <div class="meta"><b>Monstre #1</b><span class="tag">pos: (8,10) â€¢ face</span></div>
                    <button>Focus</button>
                </div>
                <div class="list-item">
                    <div class="meta"><b>Monstre #2</b><span class="tag">pos: (9,10) â€¢ cÃ´tÃ©</span></div>
                    <button>Focus</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Presets de combos</h2>
            <div class="list">
                <div class="list-item">
                    <div class="meta"><b>XÃ©lor â€“ Cycle Rouage</b><span class="tag">Transpose / Dial / Distorsion</span></div>
                    <button>Charger</button>
                </div>
                <div class="list-item">
                    <div class="meta"><b>Sinistro 15 stacks</b><span class="tag">RÃ©cup fin tour</span></div>
                    <button>Charger</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Center: Position system + Board -->
    <main class="main">
        <div class="pos-controls">
            <div class="card">
                <h2>Gestion des positions</h2>
                <div class="grid" style="grid-template-columns:repeat(2,1fr)">
                    <div class="section">
                        <label class="pill">Joueur (drag sur la carte)</label>
                        <div class="row">
                            <input type="number" placeholder="X" value="6"/>
                            <input type="number" placeholder="Y" value="10"/>
                            <select>
                                <option>Face</option><option>CÃ´tÃ©</option><option>Dos</option>
                            </select>
                        </div>
                    </div>
                    <div class="section">
                        <label class="pill">Adversaires (drag sur la carte)</label>
                        <div class="row">
                            <select>
                                <option>Monstre #1</option><option>Monstre #2</option>
                            </select>
                            <input type="number" placeholder="X" value="8"/>
                            <input type="number" placeholder="Y" value="10"/>
                            <select>
                                <option>Face</option><option>CÃ´tÃ©</option><option>Dos</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="hint">Le combat dÃ©marre T1, aucun mÃ©canisme prÃ©-placÃ©. Les sorts posent Rouage/Sinistro/Cadran. Cadran commence Ã  l'heure 12.</div>
            </div>
            <div class="card" style="min-width:40%">
                <h2>Options de simulation</h2>
                <div class="row">
                    <label class="pill">Seed RNG</label>
                    <input type="text" placeholder="alÃ©atoire" style="width:160px">
                    <label class="pill">Mode Critique</label>
                    <select>
                        <option>Probabiliste</option>
                        <option>Forcer Crit</option>
                        <option>Interdire Crit</option>
                    </select>
                </div>
                <div class="row">
                    <label class="pill">Tour de dÃ©part</label>
                    <input type="number" value="1">
                    <button class="primary">â–¶ Simuler</button>
                </div>
            </div>
        </div>

        <div class="panel tight board-panel">
            <h2>Mini-carte interactive <span class="hint">(agrandie)</span></h2>
            <div class="board">
                <div class="board-grid">
                    <!-- Les 3 cells ci-dessous sont facultatives (debug). Le damier est peint par ::before -->
                    <div class="cell"></div>
                    <div class="cell"></div>

                    <!-- ENTITÃ‰S alignÃ©es sur les cases (x,y) => (grid-column:x+1, grid-row:y+1) -->
                    <div class="entity fighter" style="grid-column:7; grid-row:11;">P</div>
                    <div class="entity enemy"   style="grid-column:9; grid-row:11;">E1</div>
                    <div class="entity enemy"   style="grid-column:11; grid-row:9;">E2</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Sidebar Right: Timeline editor (highlighted) -->
    <aside class="sidebar-right">
        <div class="panel timeline-panel">
            <div class="timeline-toolbar">
                <h2>Timeline du combo</h2>
                <div class="row">
                    <button class="ghost">Importer</button>
                    <button class="ghost">Nettoyer</button>
                    <button class="primary">Valider Timeline</button>
                </div>
            </div>
            <div class="timeline">
                <div class="step">
                    <div class="handle">â‹®â‹®</div>
                    <form>
                        <select>
                            <option>CastSpell</option>
                            <option>Move</option>
                            <option>Transpose</option>
                            <option>ChangeFacing</option>
                        </select>
                        <div class="row">
                            <input placeholder="SpellId / DÃ©tails" value="vol_du_temps">
                            <input placeholder="Target (x,y)" value="(8,10)">
                            <span class="chips">
                <span class="chip">PA:2</span>
                <span class="chip">PW:0</span>
                <span class="chip">Range:3</span>
              </span>
                        </div>
                    </form>
                    <button>âœ•</button>
                </div>
                <div class="step">
                    <div class="handle">â‹®â‹®</div>
                    <form>
                        <select><option>CastSpell</option></select>
                        <div class="row">
                            <input placeholder="SpellId / DÃ©tails" value="rouage">
                            <input placeholder="Target (x,y)" value="(7,10)">
                            <span class="chips"><span class="chip">Tag:Mechanism</span><span class="chip">Place</span></span>
                        </div>
                    </form>
                    <button>âœ•</button>
                </div>
                <div class="row">
                    <button class="ghost">+ Ajouter Ã©tape</button>
                </div>
            </div>
            <div class="hint">Les mÃ©canismes (Rouage/Sinistro/Cadran) sont posÃ©s via les Ã©tapes CastSpell correspondantes.</div>
        </div>

        <div class="panel">
            <h2>RÃ¨gles de proc (passifs / sublis)</h2>
            <div class="list">
                <div class="list-item">
                    <div class="meta"><b>MaÃ®tre du Cadran</b><span class="tag">HourWrap â†’ ExÃ©cuter effets diffÃ©rÃ©s</span></div>
                    <button>Config</button>
                </div>
                <div class="list-item">
                    <div class="meta"><b>Cours du temps</b><span class="tag">Transpose â†’ +1 PW / si Distorsion actif: +1 PA</span></div>
                    <button>Config</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Report & Analysis -->
    <section class="report">
        <div class="tabs">
            <div class="tab active">Rapport</div>
            <div class="tab">Timeline</div>
            <div class="tab">Graphes</div>
            <div class="tab">Logs</div>
            <div class="tab">Ressources</div>
        </div>
        <div class="report-content">
            <div class="block">
                <h2 style="margin-top:0">Rapport de simulation</h2>
                <div class="row">
                    <div class="pill">Total Damage: 12â€¯345</div>
                    <div class="pill">Crit effectif: 38%</div>
                    <div class="pill">Explosions Rouage: 2 @10c</div>
                    <div class="pill">Sinistro rÃ©cup: 15c</div>
                </div>
                <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
                    <div class="chart" aria-label="Damage over time"></div>
                    <div class="chart" aria-label="Resources track"></div>
                </div>
            </div>
            <div class="block">
                <h3>Timeline</h3>
                <ol>
                    <li>CastSpell Vol du temps â†’ E1 (crit: non) : 420 dmg</li>
                    <li>CastSpell Rouage @ (7,10) : mÃ©canisme placÃ© (charges 0)</li>
                    <li>CastSpell Cadran @ (6,6) : heure=12 (dÃ©part)</li>
                    <li>â€¦</li>
                    <li>TriggerExplosion Rouage (10) : 1980 dmg AoE</li>
                </ol>
                <h3>Logs</h3>
                <pre>[INFO] PA:12â†’10 aprÃ¨s Vol du temps
[PROC] Cours du temps: transpose â†’ +1 PW (Distorsion inactif)
[DMG] Pointe-heure (crit) â†’ 1120 (dos+DI)
[MECH] Sinistro charges: 14â†’15
[HEAL] Sinistro rÃ©cupÃ©rÃ©: +1 PA /5 charges, +120 PV
â€¦
        </pre>
            </div>
        </div>
    </section>
</div>

<!-- Notes d'intÃ©gration Angular
- Board interactif: Angular CDK DragDrop (cdkDrag sur entitÃ©s, cdkDropList sur cellules). Snap-to-cell au drop.
- Ou Canvas (Konva.js Angular wrapper) pour perfs + drag, hit test par grille.
- SÃ©lecteurs Sorts/Passifs/Sublis: modales (CDK Overlay) avec recherche + drag depuis liste â†’ slots (barres). Valider contraintes (12/6/10, Ã©pique/relique uniques).
- Level gating passifs: pipe qui marque slots .lock selon build.level; tooltips pour paliers 1/25/50/100/150/200.
- Timeline: CDK drag handle pour rÃ©ordonner; validation live (coÃ»ts, portÃ©e, CD). Bouton Â« Valider Timeline Â» met en surbrillance erreurs.
- DÃ©part combat: aucun mÃ©canisme; sort Cadran initialise heure=12 automatiquement cÃ´tÃ© backend.
- State: NgRx/Signals pour BoardState (entities, facing), BuildState (bars), TimelineState, ReportState.
- Persistence: localStorage + REST sync (builds, combos). -->
